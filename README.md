# ğŸ£ å›è»¢å¯¿å¸ã‚ªãƒ¼ãƒ€ãƒ¼ã‚·ã‚¹ãƒ†ãƒ 

Hono Advent Calendar 2025 ç”¨ã®ã‚µãƒ³ãƒ—ãƒ«ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã€‚

ã‚¤ãƒ™ãƒ³ãƒˆé§†å‹•ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã®å­¦ç¿’ã‚’ç›®çš„ã¨ã—ãŸã€ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ æ³¨æ–‡ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ ã§ã™ã€‚

![Demo](docs/demo.gif)

## æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯

- **Runtime**: Deno
- **Web Framework**: Hono
- **Database**: PostgreSQL + Kysely
- **Message Queue**: NATS
- **Frontend**: React + TanStack Query + Tailwind CSS
- **Real-time**: Server-Sent Events (SSE)

## ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Customer   â”‚     â”‚   Kitchen   â”‚
â”‚   Screen    â”‚     â”‚   Screen    â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚                   â”‚
       â”‚    SSE Events     â”‚
       â–¼                   â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          SSE Server              â”‚â—„â”€â”€â”€â”€ NATS Subscribe
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           API Server             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ Orders  â”‚  â”‚ Event Outbox  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚              â”‚
         â”‚              â–¼
         â”‚      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚      â”‚    Poller     â”‚â”€â”€â”€â–º NATS Publish
         â”‚      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           PostgreSQL             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—

### 1. å¿…è¦ãªãƒ„ãƒ¼ãƒ«

- [mise](https://mise.jdx.dev/) (Deno ãƒãƒ¼ã‚¸ãƒ§ãƒ³ç®¡ç†)
- [Docker](https://www.docker.com/)

### 2. Deno ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

```bash
mise install
```

### 3. ã‚¤ãƒ³ãƒ•ãƒ©ã®èµ·å‹•

```bash
docker compose up -d
```

### 4. DB ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³

```bash
deno task --filter @app/api migrate
```

### 5. åˆæœŸãƒ‡ãƒ¼ã‚¿æŠ•å…¥ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰

```bash
deno task --filter @app/api seed
```

### 6. ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³èµ·å‹•

```bash
deno task dev
```

ä»¥ä¸‹ãŒèµ·å‹•ã—ã¾ã™:

- **API Server**: http://localhost:3000
- **Swagger UI**: http://localhost:3000/ui
- **SSE Server**: http://localhost:3001
- **Web (Frontend)**: http://localhost:5173
- **Poller**: ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ã§å‹•ä½œ

## ä½¿ã„æ–¹

### å®¢ã®ç”»é¢

http://localhost:5173/customer?table=5

- ãƒ†ãƒ¼ãƒ–ãƒ«ç•ªå·ã¯ã‚¯ã‚¨ãƒªãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã§æŒ‡å®šï¼ˆä¾‹: `?table=5`ï¼‰
- å¯¿å¸ã‚’é¸ã‚“ã§ã€Œæ³¨æ–‡ã™ã‚‹ã€ã‚’ã‚¯ãƒªãƒƒã‚¯
- æ³¨æ–‡çŠ¶æ³ãŒãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã§æ›´æ–°ã•ã‚Œã‚‹

### å¨æˆ¿ã®ç”»é¢

http://localhost:5173/kitchen

- å…¨ãƒ†ãƒ¼ãƒ–ãƒ«ã®æ³¨æ–‡ã‚’ä¸€è¦§è¡¨ç¤º
- ã€Œèª¿ç†é–‹å§‹ã€â†’ã€Œé…è†³å®Œäº†ã€ã§æ³¨æ–‡ã‚’å‡¦ç†
- æ–°ã—ã„æ³¨æ–‡ãŒãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã§è¡¨ç¤ºã•ã‚Œã‚‹

## ã‚³ãƒãƒ³ãƒ‰ä¸€è¦§

| ã‚³ãƒãƒ³ãƒ‰                                   | èª¬æ˜                          |
| ------------------------------------------ | ----------------------------- |
| `deno task dev`                            | å…¨ã‚¢ãƒ—ãƒªã‚’èµ·å‹•                |
| `deno task kill`                           | ä½¿ç”¨ä¸­ã®ãƒãƒ¼ãƒˆã‚’è§£æ”¾          |
| `deno task --filter @app/api migrate`      | ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å®Ÿè¡Œ          |
| `deno task --filter @app/api migrate:down` | ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å·»ãæˆ»ã—      |
| `deno task --filter @app/api seed`         | ãƒ‡ãƒ¼ã‚¿ãƒªã‚»ãƒƒãƒˆï¼‹åˆæœŸãƒ‡ãƒ¼ã‚¿    |
| `deno task --filter @app/web generate`     | API ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆç”Ÿæˆï¼ˆorvalï¼‰ |

## è¨­è¨ˆãƒã‚¤ãƒ³ãƒˆ

### Transactional Outbox ãƒ‘ã‚¿ãƒ¼ãƒ³

æ³¨æ–‡ã®çŠ¶æ…‹æ›´æ–°ã¨ã‚¤ãƒ™ãƒ³ãƒˆè¨˜éŒ²ã‚’åŒä¸€ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³ã§è¡Œã„ã€Poller ãŒéåŒæœŸã§ NATS
ã«é…ä¿¡ã€‚ä¿¡é ¼æ€§ã®é«˜ã„ã‚¤ãƒ™ãƒ³ãƒˆé…ä¿¡ã‚’å®Ÿç¾ã€‚

### OpenAPI / Swagger UI

`@hono/zod-openapi` ã‚’ä½¿ç”¨ã—ã€Zod ã‚¹ã‚­ãƒ¼ãƒã‹ã‚‰ OpenAPI
ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’è‡ªå‹•ç”Ÿæˆã€‚http://localhost:3000/ui ã§ API ã‚’ç¢ºèªãƒ»ãƒ†ã‚¹ãƒˆå¯èƒ½ã€‚

### ãƒ¢ãƒãƒ¬ãƒæ§‹æˆ

å„ã‚¢ãƒ—ãƒªï¼ˆapi, poller, sse-server,
webï¼‰ã¯ç‹¬ç«‹ã—ã¦ãŠã‚Šã€ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸å…±æœ‰ãªã—ã€‚ã‚·ãƒ³ãƒ—ãƒ«ã•ã‚’å„ªå…ˆã€‚

### API ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆè‡ªå‹•ç”Ÿæˆ

orval ã‚’ä½¿ç”¨ã—ã€OpenAPI ã‚¹ã‚­ãƒ¼ãƒã‹ã‚‰ React Query ç”¨ã®ãƒ•ãƒƒã‚¯ã‚’è‡ªå‹•ç”Ÿæˆã€‚API
ã‚µãƒ¼ãƒãƒ¼èµ·å‹•ä¸­ã« `deno task --filter @app/web generate` ã§å†ç”Ÿæˆå¯èƒ½ã€‚

### ã‚³ãƒ¼ãƒ‰ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ

lefthook ã§ pre-commit ãƒ•ãƒƒã‚¯ã¨ã—ã¦ `deno fmt` ãŒå®Ÿè¡Œã•ã‚Œã‚‹ã€‚

## ãƒ©ã‚¤ã‚»ãƒ³ã‚¹

MIT
